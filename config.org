#+TITLE: Zach's Emacs Config

* Packages
  
** Setup
#+BEGIN_SRC emacs-lisp

  (setq package-enable-at-startup nil)
  (require 'package)
  

  (add-to-list 'package-archives
         '("melpa" . "http://melpa.org/packages/"))

  (package-initialize)

  (unless (package-installed-p 'use-package)
    (package-refresh-contents)
    (package-install 'use-package))

  (unless (package-installed-p 'diminish)
    (package-refresh-contents)
    (package-install 'diminish))

  (setq use-package-compute-statistics 1)
#+END_SRC

** Completion

#+BEGIN_SRC emacs-lisp

  (setq ido-create-new-buffer 'always)
  (setq ido-enable-flex-matching t)
  (setq ido-enable-prefix t)
  (setq ido-everywhere t)
  (ido-mode 1)
  (ido-everywhere 1)

  (use-package ido-completing-read+
    :ensure t
    :config
    (ido-ubiquitous-mode 1)
    (setq-default ido-auto-merge-work-directories-length -1))

  (use-package smex
    :ensure t
    :bind
    ("M-x" . smex)
    ("M-X" . smex-major-mode-commands)
    :config
    (smex-initialize))

#+end_src

** Swiper

#+begin_src emacs-lisp

    ;; SWIPER - SEARCH REPLACEMENT

    (use-package swiper
      :ensure t
      :bind ("C-c s" . swiper)
      :config
      (progn
        (setq ivy-use-virtual-buffers t)
        (setq enable-recursive-minibuffers t)))


#+end_src
** Text-Completion

#+BEGIN_SRC emacs-lisp

;; Auto-Complete Engine

  (use-package company
    :ensure t
    :defer 3
    :diminish (company-mode . "")
    :init
    (setq company-idle-delay 0.3)
    (setq company-begin-commands '(self-insert-command))
    (setq company-minimum-prefix-length 1)
    (setq company-tooltip-align-annotations t)
    (setq company-tooltip-limit 20)
    (setq company-dabbrev-downcase nil)
    :config
    (global-company-mode))

  (use-package company-auctex
    :ensure t
    :after (company tex)
    :config
    (company-auctex-init))

#+end_src
** Yasnippet

#+BEGIN_SRC emacs-lisp
  (use-package yasnippet
    :ensure t
    :defer 2
    :diminish (yas-minor-mode . "")
    :config (yas-global-mode 1))

  (use-package yasnippet-snippets
    :ensure t
    :defer t)
#+END_SRC

** Web-mode

#+BEGIN_SRC emacs-lisp
  (use-package web-mode
    :ensure t
    :defer t
    :mode (("\\.html\\'" . web-mode)
           ("\\.html\\.erb\\'" . web-mode)
           ("\\.css\\'" . web-mode)
           ("\\.jinja\\'" . web-mode)
           ("\\.php\\'" . web-mode)))
#+END_SRC
** Org

#+BEGIN_SRC emacs-lisp

    (use-package org
      :ensure t
      :defer 2
      :config

      ;;Add notes when task done
      (setq org-log-done 'note)
      (setq org-log-done 'time)

      ;;New Drawer Name
      ;;(add-to-list 'org-drawers "LATEX")

      ;;Follow links with RET
      (setq org-return-follows-link t)

      ;;(setq org-cycle-include-plain-lists 'integrate)

      (setq org-hide-emphasis-markers t)
      ;;(setq org-startup-with-inline-images t)
      ;;(setq org-startup-with-latex-preview t)

    
    
      ;;Notes and Capture
      (setq org-default-notes-file (concat org-directory "~/Google Drive/_.org"))
      (define-key global-map "\C-c c" 'org-capture)

      ;;Agenda Files
      (global-set-key (kbd "C-c a") 'org-agenda)
      '(org-agenda-files (quote ("~/Documents/_.org"))))

  ;; Bootstrap HTML Org Export
    (use-package ox-twbs
      :ensure t
      :defer 4)

      ;;Execute embedded python
      ;;(org-babel-do-load-languages
	;; 'org-babel-load-languages
	;; '((python . t)))

	;;Flyspell Hook
	;;(add-hook 'org-mode-hook 'flyspell-mode)

#+END_SRC
** Magit
#+BEGIN_SRC emacs-lisp
  ;;Git Control

  (use-package magit
    :ensure t
    :bind (("C-c g" . magit-status)
	   ("C-c l" . magit-log)))
#+END_SRC
** Auctex

#+begin_src emacs-lisp
  ;; Emacs Tex Integratiokn

  (use-package tex
     :defer t
     :ensure auctex
     :config
     (setq TeX-auto-save t)
     (setq TeX-parse-self t)
     (setq-default TeX-master nil)
  ;; (setq-default TeX-electric-math t)


     (add-hook 'LaTeX-mode-hook 'visual-line-mode)
     (add-hook 'LaTeX-mode-hook 'flyspell-mode)
     (add-hook 'LaTeX-mode-hook 'LaTeX-math-mode))
     (add-hook 'LaTeX-mode-hook
	       '(lambda ()
		  (define-key LaTeX-mode-map (kbd "$") 'self-insert-command)))

#+end_src
** Themes

#+BEGIN_SRC emacs-lisp
  (use-package zenburn-theme
    :ensure t
    :config (load-theme 'zenburn t)
    (add-to-list 'default-frame-alist '(ns-appearance . dark))
    (set-face-attribute 'default nil
		  :family "Roboto Mono" :height 120 :weight 'normal))
#+END_SRC

** Mode-line

#+begin_src emacs-lisp
  (use-package smart-mode-line
    :ensure t
    :config
    (setq sml/theme 'respectful)
    (setq sml/no-confirm-load-theme t)
    (setq sml/shorten-directory t)
    (setq sml/shorten-modes t)
    (column-number-mode 1)
    (add-to-list 'sml/replacer-regexp-list '("^~/.dotfiles/" ":dots:") t)
    (sml/setup))

#+end_src

** Multi-term

#+begin_src emacs-lisp

  (use-package multi-term
    :ensure t
    :bind (("C-c t" . multi-term-dedicated-toggle)
           ("C-c z" . multi-term))

    :config
    ;;(setq multi-term-program "/bin/bash")
    (setq multi-term-program "/usr/bin/zsh")
    (setq multi-term-dedicated-close-back-to-open-buffer-p t)
    (setq multi-term-dedicated-select-after-open-p t)
    (setq multi-term-dedicated-window-height 10))

#+end_src
** PDF-Tools

#+begin_src emacs-lisp

 ;; Not working for some reason - fix later

  ;; (use-package pdf-tools
  ;;   :ensure t)

  ;; Install epdfinfo via 'brew install pdf-tools' and then install the
  ;; pdf-tools elisp via the use-package below. To upgrade the epdfinfo
  ;; server, just do 'brew upgrade pdf-tools' prior to upgrading to newest
  ;; pdf-tools package using Emacs package system. If things get messed
  ;; up, just do 'brew uninstall pdf-tools', wipe out the elpa
  ;; pdf-tools package and reinstall both as at the start.
  ;; (use-package pdf-tools
  ;;   :ensure t
  ;;   :defer 4
  ;;   :config
  ;;   (custom-set-variables
  ;;    '(pdf-tools-handle-upgrades nil)) ; Use brew upgrade pdf-tools instead.
  ;;   (setq pdf-info-epdfinfo-program "/usr/local/bin/epdfinfo")
  ;;   (setq pdf-view-use-unicode-ligther nil)
  ;;   ;; more fine-grained zooming
  ;;   (setq pdf-view-resize-factor 1.1)
  ;;   (pdf-tools-install))

#+end_src

** Hyperbole

#+begin_src emacs-lisp
  (use-package hyperbole
    :ensure t
    :bind ("C-c h" . hyperbole)
    :defer 1)
#+end_src

** Ibuffer

#+begin_src emacs-lisp

    (setq ibuffer-saved-filter-groups
	  (quote (("New"

		   ("Terminal"
		    (or
		     (mode . term-mode)
		     (mode . eshell-mode)
		     ))


	     ("Magit" (name . "magit"))

		   ("Dired"
		    (mode . dired-mode))


		   ("School"
		    (filename . "Documents/Year11Notes/"))

		   ("Text" ;; all org-related buffers
		    (or
		     (mode . org-mode)
		     (mode . text-mode)

		     ))
		    ("Special" (name . "*"))

		   ))))

    (add-hook 'ibuffer-mode-hook
      (lambda ()
	(ibuffer-switch-to-saved-filter-groups "New")))


  (setq ibuffer-show-empty-filter-groups nil)


    ;; ;; Use human readable Size column instead of original one
    ;; (define-ibuffer-column size-h
    ;;   (:name "Size" :inline t)
    ;;   (cond
    ;;    ((> (buffer-size) 1000000) (format "%7.1fM" (/ (buffer-size) 1000000.0)))
    ;;    ((> (buffer-size) 100000) (format "%7.0fk" (/ (buffer-size) 1000.0)))
    ;;    ((> (buffer-size) 1000) (format "%7.1fk" (/ (buffer-size) 1000.0)))
    ;;    (t (format "%8d" (buffer-size)))))

    ;; ;; Modify the default ibuffer-formats
    ;;   (setq ibuffer-formats
    ;; 	'((mark modified read-only " "
    ;; 		(name 18 18 :left :elide)
    ;; 		" "
    ;; 		(size-h 9 -1 :right)
    ;; 		" "
    ;; 		(mode 16 16 :left :elide)
    ;; 		" "
    ;; 		filename-and-process)))
#+end_src

** Deft

#+begin_src emacs-lisp

  (use-package deft
    :ensure t
    :bind (("C-c i" . deft)
           ("C-c u" . deft-new-file))
    :config
    (setq deft-extensions '("org" "txt"))
    )
#+end_src
** Nov

#+begin_src emacs-lisp

  (use-package nov
    :ensure t
    :defer t
    :mode
    (("\\.epub\\'" . nov-mode))

    )
#+end_src

** Recentf

#+begin_src emacs-lisp

  (recentf-mode 1)
  (setq recentf-max-menu-items 25)

#+end_src
** Dired

#+begin_src emacs-lisp

  ;; using ls-lisp with these settings gives case-insensitve
  ;; sorting on OS X
  (require 'ls-lisp)
  (setq dired-listing-switches "-alhG")
  (setq ls-lisp-use-insert-directory-program nil)
  (setq ls-lisp-ignore-case t)
  (setq ls-lisp-use-string-collate nil)
  ;; customise the appearance of the listing
  (setq ls-lisp-verbosity 'nil)
  (setq ls-lisp-format-time-list '("%b %e %H:%M" "%b %e  %Y"))
  (setq ls-lisp-use-localized-time-format t)

  ;;(define-key dired-mode-map (kbd "u") 'dired-up-directory)

  ;;(add-hook 'dired-mode-hook 'dired-hide-details-mode)
#+end_src
** Misc

#+BEGIN_SRC emacs-lisp

  ;;Shows key commands when prompted
  ;; (use-package which-key
  ;;   :ensure t
  ;;   :diminish (which-key-mode . "")
  ;;   :config (which-key-mode))

  ;; ;;Better window switching
  (use-package ace-window
    :ensure t
    :diminish (ace-window-mode . "")
    :init
      (global-set-key [remap other-window] 'ace-window))

  (use-package hungry-delete
    :ensure t
    :diminish (hungry-delete-mode . "")
    :config (global-hungry-delete-mode))

  (use-package speed-type
    :ensure t
    :defer t
    :config
    (add-hook 'speed-type-mode-hook 'visual-line-mode))


  (use-package ag
    :ensure t
    :defer t)


  (use-package wttrin
    :ensure t
    :commands (wttrin)
    :init
    (setq wttrin-default-cities '("Toronto"
				  "Montreal"))
    (setq wttrin-default-accept-language '("Accept-Language" . "en-CA"))
    :bind
    ("C-c w" . wttrin))
#+END_SRC
* Defaults
** Functions

#+begin_src emacs-lisp

  (defun kill-other-buffers ()
	"Kill all other buffers."
	(interactive)
	(mapc 'kill-buffer (delq (current-buffer) (buffer-list)))
	(message "Other buffers killed"))

  (defun new-empty-buffer ()
    (interactive)
    (let (($buf (generate-new-buffer "zilch")))
      (switch-to-buffer $buf)
      (setq buffer-offer-save t)
      $buf
      (org-mode)
      ))

  (defun insert-date ()
  "Insert date at point."
  (interactive)
  (insert (format-time-string "%d/%m/%Y %H:%M")))

#+end_src

** Menu

#+begin_src emacs-lisp
    (setq inhibit-startup-message t)
    (tool-bar-mode -1)
    (toggle-scroll-bar -1)
    ;;(menu-bar-mode -1)
    (tooltip-mode -1)

    (setq initial-scratch-message ";; Wassup Buddy, you're home now
;; It's ok...
")
#+end_src
** Scrolling

#+begin_src emacs-lisp

  (global-set-key "\M-n" "\C-u1\C-v")
  (global-set-key "\M-p" "\C-u1\M-v")

  (setq mouse-wheel-scroll-amount '(1 ((shift) . 1)))
  (setq mouse-wheel-progressive-speed nil)

  (setq scroll-conservatively 10000
        scroll-preserve-screen-position t)
#+end_src

** Mark

#+begin_src emacs-lisp

;;  (transient-mark-mode nil)

#+end_src

** Disabled Commands
   
#+begin_src emacs-lisp
(put 'narrow-to-region 'disabled nil)          ; C-x n n
(put 'narrow-to-page 'disabled nil)            ; C-x n p
(put 'scroll-left 'disabled nil)               ; C-x > or <
(put 'downcase-region 'disabled nil)           ; C-x C-l
(put 'upcase-region 'disabled nil)             ; C-x C-u
(put 'set-goal-column 'disabled nil)           ; C-x C-n ==> disable with C-u
(put 'dired-find-alternate-file 'disabled nil) ; a in dired
#+end_src
** Backups
#+begin_src emacs-lisp

    ;;backups
    (setq backup-directory-alist '(("." . "~/.emacs.d/backups")))
    (setq auto-save-file-name-transforms '((".*" "~/.emacs.d/auto-save-list/" t)))
#+end_src
** Utf-8

#+begin_src emacs-lisp
    ;;use utf-8
    (setq locale-coding-system 'utf-8)
    (set-terminal-coding-system 'utf-8)
    (set-keyboard-coding-system 'utf-8)
    (set-selection-coding-system 'utf-8)
    (prefer-coding-system 'utf-8)

#+end_src
** Personal
#+begin_src emacs-lisp
    ;;Personal Information
    (setq user-full-name "Zachary Dawood"
          user-mail-address "zachary.dawood@gmail.com")

#+end_src
** Shell

Shell is weird on mac delete set-exec-path-from-shell-PATH when on linux

#+begin_src emacs-lisp
  (setq explicit-shell-file-name "/bin/bash")

  ;; Getting shell to use the correct path
  (defun set-exec-path-from-shell-PATH ()
   (let ((path-from-shell (replace-regexp-in-string
			   "[ \t\n]*$"
			    ""
			    (shell-command-to-string "$SHELL --login -i -c 'echo $PATH'"))))
      (setenv "PATH" path-from-shell)
      (setq eshell-path-env path-from-shell) ; for eshell users
      (setq exec-path (split-string path-from-shell path-separator))))

  (when window-system (set-exec-path-from-shell-PATH))

#+end_src
** Bindings

#+begin_src emacs-lisp

  (global-unset-key (kbd "C-z"))

  (global-set-key (kbd "C-c b") 'previous-buffer)
  (global-set-key (kbd "C-c c") 'org-capture)
  (global-set-key (kbd "C-c d") 'dired-jump)
  (global-set-key (kbd "C-c e") 'ibuffer)
  (global-set-key (kbd "C-c f") 'next-buffer)
  (global-set-key (kbd "C-c j") 'clean-buffer-list)
  (global-set-key (kbd "C-c k") 'kill-this-buffer)
  (global-set-key (kbd "C-c n") 'new-empty-buffer)
  (global-set-key (kbd "C-c m") 'flyspell-mode)
  (global-set-key (kbd "C-c o") 'calc)
  (global-set-key (kbd "C-c p") 'calculator)
  (global-set-key (kbd "C-c q") 'read-only-mode)
  (global-set-key (kbd "C-c r") 'recentf-open-files)
  (global-set-key (kbd "C-c v") 'visual-line-mode)
  (global-set-key (kbd "C-c x") 'imenu)
  (global-set-key (kbd "C-c y") 'rename-buffer)

  (global-set-key (kbd "C-c \S-a") 'clone-indirect-buffer)
  (global-set-key (kbd "C-c \S-c") 'calendar)
  (global-set-key (kbd "C-c \S-d") 'diary)
  (global-set-key (kbd "C-c \S-e") 'eshell)
  (global-set-key (kbd "C-c \S-f") 'dired)
  (global-set-key (kbd "C-c \S-p") 'proced)
  (global-set-key (kbd "C-c \S-s") 'speedbar)
  (global-set-key (kbd "C-c \S-l") 'eval-region)

  (global-set-key (kbd "C-x k") 'kill-other-buffers)

  (global-set-key (kbd "<s-down>")
		  (lambda () (interactive) (next-line 5)))
  (global-set-key (kbd "<s-up>")
		  (lambda () (interactive) (next-line -5)))

#+end_Src

** Misc
#+begin_src emacs-lisp
  ;;Frame Size
  (when window-system (set-frame-size (selected-frame) 120 50))

  ;;This is for line wrapping
  (add-hook 'text-mode-hook 'turn-on-visual-line-mode)
  (diminish 'visual-line-mode)
  (diminish 'auto-revert-mode)

  (delete-selection-mode t)

  (setq-default cursor-type 'bar)
  (blink-cursor-mode 1)


  (setq confirm-kill-processes nil)


  ;;Go away
  (setq visible-bell t)
  (setq ring-bell-function 'ignore)

  ;;Save Buffer State
  ;;(desktop-save-mode 1)

  (defalias 'yes-or-no-p 'y-or-n-p)

  ;;highlight matching parentheses
  (show-paren-mode 1)
  (setq show-paren-delay 0)

  ;;Add other bracket
  (electric-pair-mode 1)

  ;;new buffer mode
  (setq-default major-mode 'org-mode)

  ;;Birthday
  (when (string= "08-08" (format-time-string "%m-%d"))
    (run-with-idle-timer
     1 nil
     (lambda ()
       (let (cursor-type)
	 (animate-birthday-present Zach)))))


  (setq clean-buffer-list-delay-general 1)
#+end_src

** Zone

#+begin_src emacs-lisp

  ;; (use-package zone
  ;;   :ensure t
  ;;   :config
  ;;   (zone-when-idle 10)
  ;;   (add-hook 'zone-mode-hook 'visual-line-mode)
  ;;   (setq zone-programs [zone-pgm-putz-with-case])
  ;;   )

#+end_src

** Server

#+begin_src emacs-lisp
  (server-start

   (add-hook 'server-switch-hook
             (lambda ()
               (when (current-local-map)
                 (use-local-map (copy-keymap (current-local-map))))
               (when server-buffer-clients
                 (local-set-key (kbd "C-x k") 'server-edit)))))
#+end_src
